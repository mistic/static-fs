'use strict';

const child_process = require('child_process');

async function runMockedSimpleModuleOnChild() {
  return new Promise((resolve, reject) => {
    const mock_simple_module_proc = child_process.fork(require.resolve('mock_simple_module'), { stdio: ['pipe', 'pipe', 'pipe', 'ipc'] });

    mock_simple_module_proc.stdout.on('data', (data) => {
      console.log(data.toString());
    });

    mock_simple_module_proc.stderr.on('data', (data) => {
      console.error(data.toString());
    });

    mock_simple_module_proc.on('error', (err) => {
      console.error(err);
      reject();
    });

    mock_simple_module_proc.on('close', () => {
      resolve();
    });

    mock_simple_module_proc.send('exec->run()');
  });
}

async function run() {
  await runMockedSimpleModuleOnChild();
  console.log('mock_child_process_module has run');
}

module.exports.run = run;

